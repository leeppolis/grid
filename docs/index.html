<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=5,user-scalable=1">
  <title>Grid generator for artists</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
    }

    body {
      background-color: #e5fefe;
      color: #444;
      font-family: Helvetica, Arial, sans-serif;      
    }

    * {
      box-sizing: border-box;
    }

    .grid {
      margin: 2rem;
    }

    @media screen and (min-width: 768px) {
      .grid {
        margin: 2rem auto;
        max-width: 860px;
      }
    }

    h1 {
      font-weight: 200;
      margin: 0;
      text-align: center;
      text-transform: uppercase;
    }

    .upload {
      aspect-ratio: 16 / 9;
      background: #fff;
      color: #444;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      border: 1px solid #444;
      margin-bottom: 2rem;
    }

    .error {
      background: #fff;
      color: #cc0000;
      padding: 1rem;
      border: 1px solid #cc0000;
    }

    .note {
      font-style: italic;
    }
  </style>
</head>
<body>
  <header class="grid">
    <h1>Grid generator for artists</h1>
  </header>
  <section class="grid">
    
    <div class="error" style="display: none;">An error occurred while generating image</div>
    
    <div class="upload">
      <input type="file" id="imageInput">
      <p class="note">JPG or PNG image only, 4000x4000px max, 10Mb max.</p>
    </div>


    <label>Grid color: 
      <select id="colore">
        <option value="bianco">White</option>
        <option value="nero" selected>Black</option>
        <option value="magenta">Magenta</option>      
        <option value="ciano">Cyan</option>
      </select>
    </label><br>
    <label>Number of columns: <input type="number" id="n" min="1" max="100" value="5"></label><br>
    <label>Line width: <input type="number" id="w" min="1" max="10" value="1"></label><br>
    <button onclick="invia()">Invia</button>

    <h2>Risultato:</h2>
    <img id="outputImage" style="max-width: 600px;">
    <div class="loading" style="display: none;">Loading...</div>

    <h2>Legal</h2>
    <p>
      Images are not saved anywhere on our server. Once you upload them, the script adds the grid and then
      removes both the original file and the generated file from memory, which will be in your browser
      and nowhere else. If you want to check, <a href="https://github.com/leeppolis/grid">the source code
      is available here</a>.</p>
  </section>
  <script>
    const $loading = document.querySelector('.loading');
    const $error = document.querySelector('.error');
    async function invia() {
      $loading.style.display = 'block';
      $error.style.display = 'none';
      const imageInput = document.getElementById('imageInput');
      const colore = document.getElementById('colore').value;
      const n = document.getElementById('n').value;
      const w = document.getElementById('w').value;

      const formData = new FormData();
      formData.append('image', imageInput.files[0]);
      formData.append('colore', colore);
      formData.append('n', n);
      formData.append('width', w);

      const response = await fetch('https://grid.koolmoe.at/grid', {
        method: 'POST',
        mode: "cors",
        body: formData
      });
      $loading.style.display = 'none';
      if (response.ok) {
        const blob = await response.blob();
        document.getElementById('outputImage').src = URL.createObjectURL(blob);
      } else {
        $error.style.display = 'block';
      }
    }
  </script>
</body>
</html>