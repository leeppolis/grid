<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=5,user-scalable=1">
  <title>Grid generator for artists</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
    }

    body {
      background-color: #fefefe;
      color: #444;
      font-family: Georgia, 'Times New Roman', Times, serif;
      font-size: 1.5rem;
      line-height: 1.5;  
    }

    * {
      box-sizing: border-box;
    }

    .grid {
      margin: 2rem;
    }

    h1 {
      font-weight: 200;
      margin: 0;
      text-align: center;
    }

    .upload {
      aspect-ratio: 2 / 1;
      background: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      border: 1px solid #444;
      margin: 2rem 0;
    }

    .input {
      font-size: 2rem;
      margin: 2rem o;
      padding: 2rem;
      text-align: center;
    }

    .input input[type="number"] {
      border: 0;
      border-bottom: 1px solid #2fa6ff;
      border-radius: 0;
      color: #2fa6ff;
      font-family: Georgia, 'Times New Roman', Times, serif;
      font-size: 2rem;
      padding: 0;
      width: 4rem;
      text-align: center;

    }

    .input select {
      border: 0;
      border-bottom: 1px solid #2fa6ff;
      border-radius: 0;
      color: #2fa6ff;
      font-family: Georgia, 'Times New Roman', Times, serif;
      font-size: 2rem;
      padding: 0;
      width: 10rem;
      text-align: center;
    }

    .input button {
      background: transparent; 
      border: 0;
      box-shadow: inset 0 -0.9rem 0 0 #2fa6ffaa, inset 0 -0.5rem 0 0 #2fa6ffaa;
      color: #2fa6ff;
      cursor: pointer;
      font-family: Georgia, 'Times New Roman', Times, serif;
      font-size: 2rem;
      font-weight: 700;
      line-height: 2rem;;
      height: 2rem;
      padding: 0 1rem;
      text-align: center;
    }

    .error {
      background: #fff;
      color: #cc0000;
      margin: 2rem 0;
      text-align: center;
      padding: 1rem;
      border: 1px solid #cc0000;
    }

    .loading {
      background: #fff;
      margin: 2rem 0;
      text-align: center;
      padding: 1rem;
      border: 1px solid #444;
    }

    .note {
      font-style: italic;
    }

    @media screen and (min-width: 768px) {
      .grid {
        margin: 2rem auto;
        max-width: 860px;
      }
      .input {
        font-size: 4rem;
      }

      .input input[type="number"] {
        font-size: 4rem;
        width: 6rem;

      }

      .input select {
        font-size: 4rem;
        width: 18rem;
      }

      .input button {
        font-size: 4rem;;
        line-height: 4rem;;
        height: 4rem;
      }
    }
  </style>
</head>
<body>
  <header class="grid">
    <h1>Grid generator for artists</h1>
  </header>
  <section class="grid">
    
    <div class="upload">
      <input type="file" id="imageInput">
      <p class="note">JPG or PNG image only, 4000x4000px max, 10Mb max.</p>
    </div>

    <div class="input">
      <p>I'd like to add a grid with <label><input type="number" id="n" min="2" max="10" value="5"> columns</label>, made of <label><input type="number" id="w" min="1" max="10" value="1">px</label> <select id="colore">
        <option value="bianco">White</option>
        <option value="nero" selected>Black</option>
        <option value="magenta">Magenta</option>      
        <option value="ciano">Cyan</option>
      </select> lines. <button onclick="invia()">Please</button>.</p>
    </div>

    

    <div class="loading" style="display: none;">Loading...</div>

    <div class="result" style="display: none;">    
      <div class="error" style="display: none;">An error occurred while generating image</div>
      <img id="outputImage" style="max-width: 600px;">
    </div>
    

    <h2>Legal</h2>
    <p>
      Images are not saved anywhere on our server. Once you upload them, the script adds the grid and then
      removes both the original file and the generated file from memory, which will be in your browser
      and nowhere else. If you want to check, <a href="https://github.com/leeppolis/grid">the source code
      is available here</a>.</p>
  </section>
  <script>
    const $loading = document.querySelector('.loading');
    const $error = document.querySelector('.error');
    const $result = document.querySelector('.result');
    async function invia() {
      $result.style.display = 'none';
      $loading.style.display = 'block';
      $error.style.display = 'none';
      document.getElementById('outputImage').src = '';
      const imageInput = document.getElementById('imageInput');
      const colore = document.getElementById('colore').value;
      const n = document.getElementById('n').value;
      const w = document.getElementById('w').value;

      if (imageInput.files.length === 1) {
        const formData = new FormData();
        formData.append('image', imageInput.files[0]);
        formData.append('colore', colore);
        formData.append('n', n);
        formData.append('width', w);

        const response = await fetch('https://grid.koolmoe.at/grid', {
          method: 'POST',
          mode: "cors",
          body: formData
        });
        $loading.style.display = 'none';
        $result.style.display = 'block';
        if (response.ok) {
          const blob = await response.blob();
          document.getElementById('outputImage').src = URL.createObjectURL(blob);
        } else {
          $error.style.display = 'block';
        }
      }
    }
  </script>
</body>
</html>